<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Admin</title>
  <link rel="stylesheet" href="CSS/admin.css">
</head>
<body>
<script>
  // Verificación simple de rol admin
  const usr = JSON.parse(localStorage.getItem("usuario"));
  if (!usr || usr.Rol != 1) {
    alert("Acceso denegado.");
    window.location.href = "Index.html";
  }
</script>

<header class="admin-header">
  <h1>Panel de Administración</h1>
  <p>Bienvenido, <span id="adminNombre"></span></p>
  <button class="btn-admin btn-delete" onclick="logout()">Cerrar sesión</button>
</header>

<main class="admin-container">

  <!-- Usuarios -->
  <section class="admin-card">
    <h2>Usuarios</h2>

    <div class="admin-actions">
      <input type="number" id="filtroUsuarioId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarUsuarios">Buscar</button>
      <button class="btn-admin" id="btnVerTodosUsuarios">Ver todos</button>

      <button class="btn-action-big" onclick="abrirModalCrearUsuario()">＋ Nuevo usuario</button>
    </div>

    <table class="admin-table" id="tablaUsuarios">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Wallet -->
  <section class="admin-card">
    <h2>Wallet</h2>

    <div class="admin-actions">
      <input type="number" id="filtroWalletUsuarioId" placeholder="Buscar por ID Usuario">
      <button class="btn-admin btn-edit" onclick="cargarWalletAdmin()">Buscar</button>
      <button class="btn-admin" onclick="cargarWalletAdmin()">Ver todos</button>
    </div>

    <table class="admin-table" id="tablaWallet">
      <thead>
        <tr>
          <th>ID Wallet</th>
          <th>ID Usuario</th>
          <th>Tipo</th>
          <th>Ultimos4</th>
          <th>Nombre Titular</th>
          <th>Fecha Exp</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Aeropuertos -->
  <section class="admin-card">
    <h2>Aeropuertos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroAeropuertoId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarAeropuertos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosAeropuertos">Ver todos</button>
    </div>

    <form class="admin-form" id="formAeropuerto">
      <input type="hidden" id="aeropuertoId">
      <input type="text" id="aeropuertoNombre" placeholder="Nombre" required>
      <input type="text" id="aeropuertoCiudad" placeholder="Ciudad" required>
      <input type="text" id="aeropuertoEstado" placeholder="Estado" required>
      <button type="submit" class="btn-action">Guardar</button>
    </form>

    <table class="admin-table" id="tablaAeropuertos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Ciudad</th>
          <th>Estado</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Vuelos -->
  <section class="admin-card">
    <h2>Vuelos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroVueloId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarVuelos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosVuelos">Ver todos</button>
    </div>

    <form class="admin-form" id="formVuelo">
      <input type="hidden" id="vueloId">

      <select id="vueloOrigen" required></select>
      <select id="vueloDestino" required></select>

      <input type="datetime-local" id="vueloFechaSalida" required>
      <input type="datetime-local" id="vueloFechaLlegada" required>

      <select id="vueloEscala" required>
        <option value="DIRECTO">DIRECTO</option>
        <option value="ESCALA">ESCALA</option>
      </select>

      <input type="number" id="vueloNumEscalas" min="0" placeholder="Número de escalas" required>

      <button type="submit" class="btn-action">Guardar</button>
    </form>

    <table class="admin-table" id="tablaVuelos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Origen</th>
          <th>Destino</th>
          <th>Salida</th>
          <th>Llegada</th>
          <th>Escala</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Asientos -->
  <section class="admin-card">
    <h2>Asientos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroAsientoId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarAsientos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosAsientos">Ver todos</button>
    </div>

    <form class="admin-form" id="formAsiento">
      <input type="hidden" id="asientoId">

      <select id="asientoVuelo" required></select>

      <select id="asientoTipo" required>
        <option value="BASICO">BÁSICO</option>
        <option value="REGULAR">REGULAR</option>
        <option value="PREMIUM">PREMIUM</option>
      </select>

      <input type="number" id="asientoPrecio" min="0" placeholder="Precio" required>
      <input type="number" id="asientoStock" min="0" placeholder="Stock" required>

      <button type="submit" class="btn-action">Guardar</button>
    </form>

    <table class="admin-table" id="tablaAsientos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Vuelo</th>
          <th>Tipo</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Equipaje -->
  <section class="admin-card">
    <h2>Equipaje por vuelo</h2>

    <div class="admin-actions">
      <input type="number" id="filtroEquipajeId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarEquipaje">Buscar</button>
      <button class="btn-admin" id="btnVerTodoEquipaje">Ver todos</button>
    </div>

    <form class="admin-form" id="formEquipaje">
      <input type="hidden" id="equipajeId">

      <select id="equipajeVuelo" required></select>

      <select id="equipajeTipo" required>
        <option value="C">C (Cabina)</option>
        <option value="M">M</option>
        <option value="G">G</option>
        <option value="XL">XL</option>
        <option value="XXL">XXL</option>
      </select>

      <input type="number" id="equipajePrecio" min="0" placeholder="Precio extra" required>

      <button type="submit" class="btn-action">Guardar</button>
    </form>

    <table class="admin-table" id="tablaEquipaje">
      <thead>
        <tr>
          <th>ID</th>
          <th>Vuelo</th>
          <th>Tipo</th>
          <th>Precio</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Tipos de maleta -->
  <section class="admin-card">
    <h2>Tipos de maleta (Envíos)</h2>

    <div class="admin-actions">
      <input type="number" id="filtroMaletaId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarMaletas">Buscar</button>
      <button class="btn-admin" id="btnVerTodasMaletas">Ver todos</button>
    </div>

    <form class="admin-form" id="formMaleta">
      <input type="hidden" id="maletaId">
      <input type="text" id="maletaNombre" placeholder="Nombre" required>
      <input type="number" id="maletaPesoMax" min="0" step="0.01" placeholder="Peso máximo (kg)" required>
      <input type="number" id="maletaPrecioBase" min="0" step="0.01" placeholder="Precio base" required>
      <input type="number" id="maletaTarifaKgExtra" min="0" step="0.01" placeholder="Tarifa por kg extra" required>
      <button type="submit" class="btn-action">Guardar</button>
    </form>

    <table class="admin-table" id="tablaMaletas">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Peso max (kg)</th>
          <th>Precio base</th>
          <th>Tarifa kg extra</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Pedidos -->
  <section class="admin-card">
    <h2>Pedidos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroPedidoId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarPedidos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosPedidos">Ver todos</button>
      <button class="btn-admin" onclick="abrirModalCrearPedido()">＋ Nuevo pedido</button>
    </div>

    <!-- Se quitó el formulario grande: ahora se edita desde el botón Editar de la tabla (modal) -->

    <table class="admin-table" id="tablaPedidos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Fecha</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Pagos -->
  <section class="admin-card">
    <h2>Pagos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroPagoId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarPagos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosPagos">Ver todos</button>
      <button class="btn-admin" onclick="abrirModalCrearPago()">＋ Nuevo pago</button>
    </div>

    <!-- Se quitó el formulario grande: ahora se edita desde el botón Editar de la tabla (modal) -->

    <table class="admin-table" id="tablaPagos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Pedido</th>
          <th>Método</th>
          <th>Monto</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Boletos -->
  <section class="admin-card">
    <h2>Boletos</h2>

    <div class="admin-actions">
      <input type="number" id="filtroBoletoId" placeholder="Buscar por ID">
      <button class="btn-admin btn-edit" id="btnFiltrarBoletos">Buscar</button>
      <button class="btn-admin" id="btnVerTodosBoletos">Ver todos</button>
      <button class="btn-admin" onclick="abrirModalCrearBoleto()">＋ Nuevo boleto</button>
    </div>

    <!-- Se quitó el formulario grande: ahora se edita desde el botón Editar de la tabla (modal) -->

    <table class="admin-table" id="tablaBoletos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Vuelo</th>
          <th>Asiento</th>
          <th>Equipaje</th>
          <th>Estado</th>
          <th>Código</th>
          <th>Precio total</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>


  <!-- Dashboard de ventas -->
  <section class="admin-card" id="dashboardVentas">
    <h2>Dashboard de ventas</h2>

    <p id="ventasTotalAnual">Total anual: $0.00</p>
    <p id="ventasMejorMes">Mejor mes: -</p>
    <p id="ventasComparativa">Variación vs año anterior: -</p>
    
    <label>Año:</label>
    <select id="ventasYear"></select>

    <div style="height:360px">
      <canvas id="ventasChart"></canvas>
    </div>
    <h4>Monto promedio por ticket.</h4>
    <h4 id="ventasTicketPromedio"></h4>

    <h4>Top usuarios</h4>
    <ul id="ventasTopUsuarios"></ul>

    <h4>Top rutas</h4>
    <ul id="ventasTopRutas"></ul>


    <div class="dashboard-chart">
      <canvas id="ventasChart"></canvas>
    </div>
  </section>

</main>

<!-- ==========================================================
        MODALES — Panel Admin
========================================================== -->

<!-- Modal: Crear usuario -->
<div class="modalVV oculto" id="modalCrearUsuario">
  <div class="modalVV-content">
    <h2>Nuevo usuario</h2>

    <form id="formCrearUsuario">
      <input id="nuevoUsuarioNombre" class="input-modal" placeholder="Nombre" required>
      <input id="nuevoUsuarioApellido" class="input-modal" placeholder="Apellido" required>
      <input id="nuevoUsuarioCorreo" class="input-modal" type="email" placeholder="Correo" required>
      <input id="nuevoUsuarioTelefono" class="input-modal" placeholder="Teléfono (10 dígitos)" maxlength="10" required>
      <input id="nuevoUsuarioPassword" class="input-modal" type="password" placeholder="Contraseña temporal" required>

      <select id="nuevoUsuarioRol" class="input-modal" required>
        <option value="0">Usuario</option>
        <option value="1">Admin</option>
        <option value="2">WRK</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Guardar</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalCrearUsuario()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Editar usuario -->
<div class="modalVV oculto" id="modalEditarUsuario">
  <div class="modalVV-content">
    <h2>Editar usuario</h2>

    <form id="formEditarUsuario">
      <input type="hidden" id="editarUsuarioId">

      <input id="editarUsuarioNombre" class="input-modal" placeholder="Nombre" required>
      <input id="editarUsuarioApellido" class="input-modal" placeholder="Apellido" required>
      <input id="editarUsuarioCorreo" class="input-modal" type="email" placeholder="Correo" required>
      <input id="editarUsuarioTelefono" class="input-modal" placeholder="Teléfono (10 dígitos)" maxlength="10" required>

      <select id="editarUsuarioRol" class="input-modal" required>
        <option value="0">Usuario</option>
        <option value="1">Admin</option>
        <option value="2">WRK</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Guardar cambios</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalEditarUsuario()">Cerrar</button>
      </div>
    </form>
  </div>
</div>


<!-- Modal: Crear pedido -->
<div class="modalVV oculto" id="modalCrearPedido">
  <div class="modalVV-content">
    <h2>Nuevo pedido</h2>

    <form id="formCrearPedido">
      <input id="nuevoPedidoUsuario" class="input-modal" type="number" placeholder="ID usuario" required>
      <input id="nuevoPedidoWallet" class="input-modal" type="number" placeholder="ID wallet" required>
      <input id="nuevoPedidoTotal" class="input-modal" type="number" min="0" step="0.01" placeholder="Total" required>

      <select id="nuevoPedidoEstado" class="input-modal" required>
        <option value="PENDIENTE">PENDIENTE</option>
        <option value="PAGADO">PAGADO</option>
        <option value="CANCELADO">CANCELADO</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Crear</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalCrearPedido()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Crear pago -->
<div class="modalVV oculto" id="modalCrearPago">
  <div class="modalVV-content">
    <h2>Nuevo pago</h2>

    <form id="formCrearPago">
      <input id="nuevoPagoUsuario" class="input-modal" type="number" placeholder="ID usuario" required>
      <input id="nuevoPagoPedido" class="input-modal" type="number" placeholder="ID pedido" required>
      <input id="nuevoPagoMonto" class="input-modal" type="number" min="0" step="0.01" placeholder="Monto" required>

      <select id="nuevoPagoEstado" class="input-modal" required>
        <option value="PENDIENTE">PENDIENTE</option>
        <option value="APROBADO">APROBADO</option>
        <option value="RECHAZADO">RECHAZADO</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Crear</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalCrearPago()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Crear boleto -->
<div class="modalVV oculto" id="modalCrearBoleto">
  <div class="modalVV-content">
    <h2>Nuevo boleto</h2>

    <form id="formCrearBoleto">
      <input id="nuevoBoletoUsuario" class="input-modal" type="number" placeholder="ID usuario" required>
      <input id="nuevoBoletoVuelo" class="input-modal" type="number" placeholder="ID vuelo" required>
      <input id="nuevoBoletoAsiento" class="input-modal" type="number" placeholder="ID asiento" required>
      <input id="nuevoBoletoEquipaje" class="input-modal" type="number" placeholder="ID equipaje (opcional)">
      <input id="nuevoBoletoPedido" class="input-modal" type="number" placeholder="ID pedido" required>
      <input id="nuevoBoletoPrecio" class="input-modal" type="number" min="0" step="0.01" placeholder="Precio total" required>

      <select id="nuevoBoletoEstado" class="input-modal" required>
        <option value="Activo">Activo</option>
        <option value="Usado">Usado</option>
        <option value="Cancelado">Cancelado</option>
        <option value="Pendiente">Pendiente</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Crear</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalCrearBoleto()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Editar pedido -->
<div class="modalVV oculto" id="modalEditarPedido">
  <div class="modalVV-content">
    <h2>Editar pedido</h2>

    <form id="formEditarPedido">
      <input type="hidden" id="pedidoModalId">

      <input id="pedidoModalUsuario" class="input-modal" placeholder="ID usuario" readonly>
      <input id="pedidoModalWallet" class="input-modal" placeholder="ID wallet" readonly>
      <input id="pedidoModalFecha" class="input-modal" placeholder="Fecha" readonly>
      <input id="pedidoModalTotal" class="input-modal" placeholder="Total" readonly>

      <select id="pedidoModalEstado" class="input-modal" required>
        <option value="PENDIENTE">PENDIENTE</option>
        <option value="PAGADO">PAGADO</option>
        <option value="CANCELADO">CANCELADO</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Guardar cambios</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalEditarPedido()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Editar pago -->
<div class="modalVV oculto" id="modalEditarPago">
  <div class="modalVV-content">
    <h2>Editar pago</h2>

    <form id="formEditarPago">
      <input type="hidden" id="pagoModalId">

      <input id="pagoModalUsuario" class="input-modal" placeholder="ID usuario" readonly>
      <input id="pagoModalPedido" class="input-modal" placeholder="ID pedido" readonly>
      <input id="pagoModalFecha" class="input-modal" placeholder="Fecha pago" readonly>
      <input id="pagoModalMonto" class="input-modal" placeholder="Monto" readonly>

      <select id="pagoModalEstado" class="input-modal" required>
        <option value="APROBADO">APROBADO</option>
        <option value="RECHAZADO">RECHAZADO</option>
        <option value="PENDIENTE">PENDIENTE</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Guardar cambios</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalEditarPago()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Editar boleto -->
<div class="modalVV oculto" id="modalEditarBoleto">
  <div class="modalVV-content">
    <h2>Editar boleto</h2>

    <form id="formEditarBoleto">
      <input type="hidden" id="boletoModalId">

      <input id="boletoModalUsuario" class="input-modal" placeholder="ID usuario" readonly>
      <input id="boletoModalVuelo" class="input-modal" placeholder="ID vuelo" readonly>
      <input id="boletoModalAsiento" class="input-modal" placeholder="ID asiento" readonly>
      <input id="boletoModalEquipaje" class="input-modal" placeholder="ID equipaje (opcional)" readonly>
      <input id="boletoModalPedido" class="input-modal" placeholder="ID pedido" readonly>
      <input id="boletoModalPrecio" class="input-modal" placeholder="Precio total" readonly>

      <select id="boletoModalEstado" class="input-modal" required>
        <option value="Activo">Activo</option>
        <option value="Usado">Usado</option>
        <option value="Cancelado">Cancelado</option>
        <option value="Pendiente">Pendiente</option>
      </select>

      <div class="modalVV-actions">
        <button type="submit" class="btnVV">Guardar cambios</button>
        <button type="button" class="btnVV-cerrar" onclick="cerrarModalEditarBoleto()">Cerrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
 <script src="JS/paginacion50.js"></script>
 <script src="JS/navbar.js"></script>
<script src="JS/wallet.js"></script>
<script src="JS/admin.js"></script>
<script src="JS/chart.js"></script>
<script src="JS/dashboardVentas.js"></script>

</body>
</html>